<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PO・TORO 公式ポータル</title>

<style>
:root{--ink:#333;--card:#ffffffcc;--shadow:0 10px 30px rgba(0,0,0,.12)}
html,body{margin:0;font-family:"Noto Sans JP",sans-serif;background:linear-gradient(135deg,#f6b7d2,#a9d6f7);background-attachment:fixed}
img{max-width:100%;display:block}
.container{width:min(1100px,92vw);margin:0 auto}
section{padding:34px 0}
.sec-title{font-weight:900;font-size:1.3rem;margin:0 0 14px}
/* STATUS（失敗/0件時のみ表示） */
#newsStatus,#eventsStatus,#scheduleStatus{
  display:none!important;color:#d63384;text-align:center;
  margin-top:12px;font-weight:700;font-size:.9rem
}
.card{background:#fff;border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
.card .body{padding:12px}
.grid{display:grid;gap:16px}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
</style>
</head>

<body>
<header style="position:sticky;top:0;background:#ffffffcc;padding:12px 0;backdrop-filter:blur(6px)">
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;font-weight:900">
    <div>concept cafe PO・TORO</div>
    <nav style="display:flex;gap:12px">
      <a href="#news">お知らせ</a>
      <a href="#events">イベント</a>
      <a href="#maids">メイド</a>
      <a href="#schedule">営業日</a>
    </nav>
  </div>
</header>

<main>

<!-- HERO -->
<section class="hero">
  <div class="container" style="display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:center">
    <div>
      <h1 style="font-size:2rem;font-weight:900;margin:.3em 0">ようこそ♡ PO・TOROへ</h1>
      <p>イベント・メイドさん紹介・ゲームへの入り口です！</p>
    </div>
    <div class="card">
      <a href="https://x.com/po_toro" target="_blank" rel="noopener">
        <img src="img/potro_twi.jpg" alt="PO・TORO キービジュアル（クリックでXへ）">
      </a>
    </div>
  </div>
</section>

<!-- 🗞️ お知らせ -->
<section id="news">
 <div class="container">
  <h2 class="sec-title">🗞️ お知らせ</h2>
  <ul id="newsList"></ul>
  <div id="newsStatus"></div>
 </div>
</section>

<!-- 🎉 イベント -->
<section id="events">
 <div class="container">
  <h2 class="sec-title">🎉 イベント</h2>
  <div class="grid cols-3" id="eventsGrid"></div>
  <div id="eventsStatus"></div>
 </div>
</section>

<!-- 👑 メイド -->
<section id="maids">
 <div class="container">
  <h2 class="sec-title">👑 メイドさん紹介</h2>
  <div class="grid cols-3">
    <article class="card">
      <img src="img/potro_cafe_maiddemo_final.png" alt="メイド紹介">
      <div class="body">
        <h3>メイドさん一覧</h3>
        <a href="https://potoro1001.github.io/potoro-profile-public/" target="_blank" rel="noopener">→ プロフィールへ</a>
      </div>
    </article>
  </div>
 </div>
</section>

<!-- 📅 スケジュール -->
<section id="schedule">
 <div class="container">
   <h2 class="sec-title">📅 営業スケジュール（直近7日）</h2>
   <table style="width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden">
     <thead><tr><th>日付</th><th>営業時間</th><th>メモ</th></tr></thead>
     <tbody id="scheduleBody"></tbody>
   </table>
   <div id="scheduleStatus"></div>
 </div>
</section>

</main>



<script>
// ✅ CSV設定
const CONFIG = {
  news:    "https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=1650494358",
  events:  "https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=365949763",
  schedule:"https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=1276825118"
};

// ✅ 準備中メッセージ
const MSG_READY = "ただいま準備中です♡ もう少しお待ちください！";

// ✅ HTMLエスケープ
const esc=s=>String(s||"").replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));

// ✅ CSV読込
async function loadCSV(url){
  const res = await fetch(url+"&t="+Date.now());
  if(!res.ok) throw new Error(res.status);
  return await res.text();
}

// ✅ CSV → 配列
function parseCSV(txt){
  return txt.split(/\r?\n/).map(r=>r.split(","));
}

// ✅ 日付→曜日付加
function fmtDateJP(s){
  const m=s.match(/(\d{1,2})[\/月.-](\d{1,2})/);
  if(!m) return s;
  const [_,M,D]=m;
  const y=new Date().getFullYear();
  const dt=new Date(`${y}/${M}/${D}`);
  const wd=["日","月","火","水","木","金","土"][dt.getDay()];
  return `${M}/${D}(${wd})`;
}

// ✅ お知らせ描画
async function renderNews(){
  try{
    const csv=await loadCSV(CONFIG.news);
    const rows=parseCSV(csv).slice(1).filter(r=>r[0]||r[2]);
    if(rows.length===0){
      newsStatus.textContent=MSG_READY;
      newsStatus.style.display="block";
      return;
    }
    newsList.innerHTML = rows.map(r=>{
      return `<li><time>${esc(r[0])}</time> ${esc(r[2])}</li>`;
    }).join("");
    newsStatus.style.display="none";
  }catch(e){
    newsStatus.textContent="読み込みに失敗しました…";
    newsStatus.style.display="block";
  }
}

// ✅ イベント描画
async function renderEvents(){
  try{
    const csv=await loadCSV(CONFIG.events);
    const rows=parseCSV(csv).slice(1).filter(r=>r[0]||r[2]);
    if(rows.length===0){
      eventsStatus.textContent=MSG_READY;
      eventsStatus.style.display="block";
      return;
    }
    eventsGrid.innerHTML = rows.map(r=>{
      return `<article class="card"><img src="${r[2]}" alt=""><div class="body"><h3>${esc(r[0])}</h3><p>${esc(r[1])}</p></div></article>`;
    }).join("");
    eventsStatus.style.display="none";
  }catch{
    eventsStatus.textContent="読み込みに失敗しました…";
    eventsStatus.style.display="block";
  }
}

// ✅ スケジュール描画（直近7日間）
async function renderSchedule(){
  try{
    const csv=await loadCSV(CONFIG.schedule);
    const rows=parseCSV(csv).slice(1);
    const today=new Date(); today.setHours(0,0,0,0);
    const limit=new Date(today); limit.setDate(limit.getDate()+7);
    const list=rows.filter(r=>{
      const d=new Date(r[0]); d.setHours(0,0,0,0);
      return d>=today && d<=limit;
    });

    if(list.length===0){
      scheduleStatus.textContent=MSG_READY;
      scheduleStatus.style.display="block";
      scheduleBody.innerHTML="";
      return;
    }

    scheduleBody.innerHTML = list.map(r=>
      `<tr><td>${fmtDateJP(r[0])}</td><td>${esc(r[1])}</td><td>${esc(r[2])}</td></tr>`
    ).join("");
    scheduleStatus.style.display="none";
  }catch{
    scheduleStatus.textContent="読み込みに失敗しました…";
    scheduleStatus.style.display="block";
  }
}

document.addEventListener("DOMContentLoaded",()=>{
  renderNews();
  renderEvents();
  renderSchedule();
});
</script>

</body>
</html>
