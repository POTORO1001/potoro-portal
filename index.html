<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PO・TORO 公式ポータル</title>
  <meta name="description" content="concept cafe PO・TORO（ポ・トロ）の総合ポータル。最新イベント、メイドさん紹介、アクセス、各種コンテンツへの入口をひとまとめ。" />
  <meta name="format-detection" content="telephone=no" />
  <!-- OGP -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PO・TORO 公式ポータル" />
  <meta property="og:description" content="concept cafe PO・TORO（ポ・トロ）の最新情報とリンク集。" />
  <meta property="og:image" content="img/ogp.jpg" />
  <meta property="og:url" content="https://example.com" />
  <link rel="icon" href="img/favicon.png" />
  <style>
    :root{--pink:#f6b7d2;--blue:#a9d6f7;--ink:#333;--card:#ffffffcc;--shadow:0 10px 30px rgba(0,0,0,.12)}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:"-apple-system","BlinkMacSystemFont","Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji",sans-serif;color:var(--ink);background:linear-gradient(135deg,var(--pink),var(--blue));background-attachment: fixed}
    a{color:#0b69d5;text-decoration:none}
    img{max-width:100%;height:auto;display:block}
    .container{width:min(1100px,92vw);margin:0 auto}

    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(10px);background:rgba(255,255,255,.75);box-shadow:0 2px 12px rgba(0,0,0,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-logo{width:40px;height:40px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, #ffe2ee 60%, #ffd3ea 100%);display:grid;place-items:center;box-shadow:var(--shadow)}
    .brand-logo span{font-weight:900;color:#ff5ea8}
    .brand-title{font-weight:800;letter-spacing:.08em}
    .brand-title .en{font-size:1.05rem}
    .brand-title .jp{font-size:.8rem;color:#666}
    .nav-links{display:flex;gap:14px;align-items:center}
    .nav-links a{padding:8px 12px;border-radius:999px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.06);font-size:.92rem}
    .hamburger{display:none;background:#fff;border:none;border-radius:12px;padding:9px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .hamburger svg{width:22px;height:22px}
    @media (max-width:880px){.nav-links{display:none}.hamburger{display:inline-grid}.drawer{position:fixed;inset:0 0 0 auto;width:min(84vw,360px);background:#fff;box-shadow:-20px 0 40px rgba(0,0,0,.18);transform:translateX(100%);transition:.3s;z-index:60;display:flex;flex-direction:column}.drawer.open{transform:translateX(0)}.drawer .head{display:flex;align-items:center;justify-content:space-between;padding:16px}.drawer a{padding:14px 18px;border-bottom:1px solid #eee}}

    .hero{position:relative;isolation:isolate}
    .hero .wrap{display:grid;grid-template-columns:1.2fr .8fr;gap:24px;align-items:center;padding:40px 0}
    .badge{display:inline-flex;gap:8px;align-items:center;background:#fff;border-radius:999px;padding:6px 10px;box-shadow:var(--shadow);font-size:.85rem}
    .headline{font-size:clamp(1.6rem,4vw,2.6rem);line-height:1.16;margin:.4rem 0 .2rem;font-weight:900;letter-spacing:.02em}
    .sub{color:#444;margin:.2rem 0 1rem}
    .cta{display:flex;flex-wrap:wrap;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:14px;border:none;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn-primary{background:linear-gradient(135deg,#ff81c0,#8ed2ff);color:#fff}
    .btn-ghost{background:#fff;color:#333}
    .hero-card{background:var(--card);backdrop-filter: blur(8px);padding:14px;border-radius:14px;box-shadow:var(--shadow)}
    .hero-kv{width:100%;height:auto;object-fit:contain;background:#fff;border-radius:12px}

    section{padding:34px 0}
    .sec-title{font-weight:900;font-size:1.3rem;margin:0 0 14px 0;display:flex;align-items:center;gap:8px}
    .ticker{background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .ticker ul{list-style:none;margin:0;padding:0}
    .ticker li{display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid #eee}
    .ticker time{font-variant-numeric:tabular-nums;color:#666;min-width:7.7em}
    .label{display:inline-block;padding:.2em .6em;border-radius:999px;font-size:.75rem;font-weight:700;color:#fff;background:#ff72b4}

    .grid{display:grid;gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    @media (max-width:1024px){.grid.cols-4{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:880px){.grid.cols-4,.grid.cols-3{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.grid.cols-4,.grid.cols-3{grid-template-columns:1fr}}

    .card{background:#fff;border-radius:18px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card .thumb{aspect-ratio:16/9;background:#f4f4f4;object-fit:cover}
    .card .body{padding:12px 14px}
    .card h3{margin:.2rem 0 .4rem;font-size:1.05rem}
    .card p{margin:0;color:#555;font-size:.92rem}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#fafafa;border:1px solid #eee;border-radius:999px;padding:4px 8px;font-size:.78rem}

    .qlink{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;text-align:center;background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:18px;min-height:120px}

    .table{width:100%;border-collapse:collapse;background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .table th,.table td{padding:12px;border-bottom:1px solid #eee;text-align:left}
    .table th{background:#fafafa}

    footer{padding:28px 0;color:#333}
    .foot{display:grid;gap:16px;grid-template-columns:2fr 1fr 1fr}
    .foot h4{margin:.2rem 0 .6rem}
    .sns{display:flex;gap:10px}
    .copyright{margin-top:12px;font-size:.85rem;color:#555}
    @media (max-width:880px){.foot{grid-template-columns:1fr}}

    .hidden{display:none}
    .mt-8{margin-top:8px}.mt-12{margin-top:12px}.mt-16{margin-top:16px}.mt-24{margin-top:24px}
    .tag{font-size:.75rem;color:#666}

    /* 画像ビューア（ライトボックス） */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;padding:4vw;z-index:100;opacity:0;pointer-events:none;transition:.2s}
    .lightbox.open{opacity:1;pointer-events:auto}
    .lightbox img{max-width:100%;max-height:100%;object-fit:contain;box-shadow:0 8px 30px rgba(0,0,0,.5);border-radius:10px}
    .lightbox .close{position:absolute;top:16px;right:16px;background:#fff;border:none;border-radius:999px;font-size:16px;padding:8px 12px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <nav class="nav container" aria-label="Main">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"><span>PT</span></div>
        <div class="brand-title">
          <div class="en">concept cafe <span style="letter-spacing:.12em">PO・TORO</span></div>
          <div class="jp">ポ・トロ 公式ポータル</div>
        </div>
      </div>
      <div class="nav-links" id="navLinks">
        <a href="#news">お知らせ</a>
        <a href="#events">イベント</a>
        <a href="#maids">メイドさん紹介</a>
        <a href="#games">ゲーム/診断</a>
        <a href="#schedule">営業日</a>
        <a href="#access">アクセス</a>
      </div>
      <button class="hamburger" id="btnMenu" aria-label="メニューを開く" aria-controls="drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
      </button>
    </nav>
    <div class="drawer" id="drawer" aria-hidden="true">
      <div class="head">
        <div style="font-weight:800">メニュー</div>
        <button id="btnClose" aria-label="閉じる">✕</button>
      </div>
      <a href="#news">お知らせ</a>
      <a href="#events">イベント</a>
      <a href="#maids">メイドさん紹介</a>
      <a href="#games">ゲーム/診断</a>
      <a href="#schedule">営業日</a>
      <a href="#access">アクセス</a>
      <a href="#sns">SNS</a>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <div class="container wrap">
        <div>
          <span class="badge" aria-label="最新の更新">🔔 最新情報をチェック</span>
          <h1 class="headline">ようこそ、ご主人さま・お嬢さま。<br>PO・TOROの入口はここ♡</h1>
          <p class="sub">イベント、メイドさん紹介、ゲームや各種リンクをこのページに集約しました。ブックマーク推奨です！</p>
          <div class="cta">
            <a class="btn btn-primary" href="#events">イベント案内へ</a>
            <a class="btn btn-ghost" href="#games">診断・ゲームで遊ぶ</a>
          </div>
          <div class="hero-card mt-16">
            <strong>お知らせ：</strong>
            <span class="tag">（例）10/28–11/01 ハロウィン仮装お給仕開催・先着でお菓子プレゼント！</span>
          </div>
        </div>
        <div class="hero-card">
          <img src="img/potro_twi.jpg" alt="PO・TORO キービジュアル" class="thumb hero-kv" loading="lazy" />
        </div>
      </div>
    </section>

    <!-- News -->
    <section id="news">
      <div class="container">
        <h2 class="sec-title">🗞️ お知らせ</h2>
        <div class="ticker" aria-live="polite">
          <ul id="newsList"></ul>
        </div>
        <div id="newsStatus" class="tag mt-12" aria-live="polite"></div>
      </div>
    </section>

    <!-- Events -->
    <section id="events">
      <div class="container">
        <h2 class="sec-title">🎉 イベント</h2>
        <div class="grid cols-3" id="eventsGrid"></div>
        <div id="eventsStatus" class="tag mt-12" aria-live="polite"></div>
      </div>
    </section>

    <!-- メイドさん紹介 -->
    <section id="maids">
      <div class="container">
        <h2 class="sec-title">👑 メイドさん紹介</h2>
        <div class="mt-12">
          <a class="btn btn-ghost" href="public.html" target="_blank" rel="noopener">プロフィール一覧</a>
        </div>
      </div>
    </section>

    <!-- Games / Tools -->
    <section id="games">
      <div class="container">
        <h2 class="sec-title">🎮 ゲーム / 診断</h2>
        <div class="grid cols-4">
          <a class="qlink" href="#" id="linkQuest">
            <div>🗝️</div>
            <div><strong>ポ・トロクエスト</strong></div>
            <small class="tag">完成版（基準ビルド）</small>
          </a>
          <a class="qlink" href="#" id="linkMBTI">
            <div>💘</div>
            <div><strong>ご主人様タイプ診断</strong></div>
            <small class="tag">MBTIミニ12問・レースver.</small>
          </a>
        </div>
      </div>
    </section>

    <!-- Schedule -->
    <section id="schedule">
      <div class="container">
        <h2 class="sec-title">📅 営業スケジュール（直近7日）</h2>
        <table class="table" aria-label="営業日と営業時間">
          <thead><tr><th>日付</th><th>営業時間</th><th>メモ</th></tr></thead>
          <tbody id="scheduleBody"></tbody>
        </table>
        <div id="scheduleStatus" class="tag mt-12" aria-live="polite"></div>
      </div>
    </section>

    <!-- Access -->
    <section id="access">
      <div class="container">
        <h2 class="sec-title">📍 アクセス</h2>
        <div class="grid cols-3">
          <div class="card" style="grid-column: span 2;">
            <div class="body">
              <h3>店舗情報</h3>
              <p>〒790-0012 愛媛県松山市湊町3-7-2 2F</p>
              <p>営業時間：平日＆祝 18:00–22:00 / 土日 17:00–22:00</p>
              <p>料金：30分 1,000円(税込) 各種ドリンク飲み放題（生ビール含む）</p>
              <p class="tag">※放置ゼロ宣言＆キャストドリンク無しで安心♪</p>
            </div>
          </div>
          <div class="card">
  <div class="body">
    <h3>地図</h3>
    <div style="position:relative;width:100%;padding-top:56.25%;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.12)">
      <iframe title="PO・TORO の場所" src="https://www.google.com/maps?q=33.8359588,132.7696145&z=18&output=embed" style="position:absolute;inset:0;border:0;width:100%;height:100%" loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen></iframe>
    </div>
    <p class="mt-12"><a href="https://www.google.com/maps/place/PO.TORO/@33.8358626,132.7688299,18.58z/data=!4m6!3m5!1s0x354fe5dbb968cdff:0x8b5f6bd36d2edd83!8m2!3d33.8359588!4d132.7696145!16s%2Fg%2F11h7sfhxcy?entry=ttu&g_ep=EgoyMDI1MTAxNC4wIKXMDSoASAFQAw%3D%3D" target="_blank" rel="noopener">Google マップで開く</a></p>
  </div>
</div>
        </div>
      </div>
    </section>

    <!-- SNS -->
    <section id="sns">
      <div class="container">
        <h2 class="sec-title">📡 公式SNS</h2>
        <div class="sns">
          <a class="qlink" href="https://x.com/po_toro" target="_blank" aria-label="X / Twitter">🕊️ X（@po_toro）</a>
          <a class="qlink" href="https://www.tiktok.com/@potoro_o" target="_blank" aria-label="TikTok">🎵 TikTok（@potoro_o）</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <div>
        <h4>concept cafe PO・TORO</h4>
        <p>ご帰宅ありがとうございます。イベントや限定メニューの最新情報は本ポータルからご確認ください。</p>
        <div class="copyright">© <span id="year"></span> PO・TORO / concept cafe. All rights reserved.</div>
      </div>
      <div>
        <h4>リンク</h4>
        <ul>
          <li><a href="#events">イベント</a></li>
          <li><a href="#maids">メイドさん紹介</a></li>
          <li><a href="#games">ゲーム/診断</a></li>
        </ul>
      </div>
      <div>
        <h4>ポリシー</h4>
        <ul>
          <li><a href="#">利用規約</a></li>
          <li><a href="#">プライバシー</a></li>
          <li><a href="#">特定商取引法</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- ライトボックス（全画面画像ビューア） -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="画像ビューア">
    <button type="button" class="close" aria-label="閉じる (Esc)">閉じる ✕</button>
    <img id="lightboxImg" alt="拡大画像" />
  </div>

  <script>
    // =========================
    // 設定：Googleスプレッドシート公開CSV
    // =========================
    window.PORTAL_CONFIG = {
      eventsCsvUrl: "https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=365949763",
      newsCsvUrl:   "https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=1650494358",
      scheduleCsvUrl:"https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=0"
    };

    // =========================
    // 便利関数
    // =========================
    function escapeHtml(str){ return String(str).replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s])); }
    function normalizeHeader(s){ let t=String(s||''); if(t && t.charCodeAt(0)===0xFEFF) t=t.slice(1); return t.trim().toLowerCase(); }

    // CSVパーサ（カンマ・改行・引用符対応）
    function parseCSV(text){
      const rows=[]; let i=0, field='', row=[], inQ=false;
      while(i<text.length){ const c=text[i];
        if(inQ){ if(c==='"'){ if(text[i+1]==='"'){ field+='"'; i+=2; continue;} inQ=false; i++; continue; } field+=c; i++; continue; }
        if(c==='"'){ inQ=true; i++; continue; }
        if(c===','){ row.push(field); field=''; i++; continue; }
        if(c==='\n'||c==='\r'){ if(c==='\r'&&text[i+1]==='\n') i++; row.push(field); field=''; if(row.length && row.join('').trim()!=='') rows.push(row); row=[]; i++; continue; }
        field+=c; i++;
      }
      if(field!=='' || row.length){ row.push(field); rows.push(row); }
      return rows;
    }

    // CSV→オブジェクト
    function csvToNewsObjects(csv){
      const rows=parseCSV(csv).filter(r=>r.length && r.join('').trim()!==''); if(!rows.length) return [];
      const h=rows[0].map(normalizeHeader); const idx=(keys)=>{for(const k of keys){const i=h.indexOf(k); if(i!==-1) return i;} return -1;};
      const di=idx(['date','日付','掲載日']); const li=idx(['label','ラベル','タグ']); const ti=idx(['text','本文','お知らせ','内容']);
      return rows.slice(1).map(r=>({date:di>-1?r[di]:'', label:li>-1?r[li]:'', text:ti>-1?r[ti]:''})).filter(o=>o.date || o.text);
    }
    function csvToEventObjects(csv){
      const rows=parseCSV(csv).filter(r=>r.length && r.join('').trim()!==''); if(!rows.length) return [];
      const h=rows[0].map(normalizeHeader); const idx=(keys)=>{for(const k of keys){const i=h.indexOf(k); if(i!==-1) return i;} return -1;};
      const ti=idx(['title','タイトル','件名','イベント名']); const di=idx(['datetext','date','日付','期間','date_text']);
      const ii=idx(['image','画像','img','imageurl','image_url']); const ai=idx(['alt','代替','代替テキスト','alttext']); const ci=idx(['chip','タグ','tag','ラベル']);
      return rows.slice(1).map(r=>({ title:ti>-1?r[ti]:'', datetext:di>-1?r[di]:'', image:ii>-1?r[ii]:'', alt:ai>-1?r[ai]:'', chip:ci>-1?r[ci]:'' })).filter(o=> (o.title&&o.title.trim()) || (o.image&&o.image.trim()));
    }
    function csvToScheduleObjects(csv){
      const rows=parseCSV(csv).filter(r=>r.length && r.join('').trim()!==''); if(!rows.length) return [];
      const h=rows[0].map(normalizeHeader); const idx=(keys)=>{for(const k of keys){const i=h.indexOf(k); if(i!==-1) return i;} return -1;};
      const di=idx(['date','日付','営業日']); const hi=idx(['hours','営業時間','open','openhours']); const ni=idx(['note','メモ','備考','補足']);
      return rows.slice(1).map(r=>({ date:di>-1?r[di]:'', hours:hi>-1?r[hi]:'', note:ni>-1?r[ni]:'' })).filter(o=>o.date||o.hours||o.note);
    }

    function parseSheetDateToJsDate(s){
      const str=String(s||'').trim();
      const m=str.replace(/[()（）]/g,'').match(/(\d{1,4})[\/年-]?(\d{1,2})[\/月-]?(\d{1,2})/);
      if(m){ const y=m[1].length===4? Number(m[1]) : new Date().getFullYear(); return new Date(`${y}/${m[2]}/${m[3]}`); }
      const n=Number(str); if(!Number.isNaN(n) && n>20000 && n<60000){ const base=new Date(Date.UTC(1899,11,30)); return new Date(base.getTime()+n*86400000); }
      return null;
    }

    async function loadCSV(url){ const res=await fetch(url+`&cb=${Date.now()}`,{cache:'no-store',credentials:'omit'}); if(!res.ok) throw new Error(`fetch error ${res.status}`); return await res.text(); }

    // 描画
    function renderNews(){
      const ul=document.getElementById('newsList'); if(!ul) return;
      ul.innerHTML=(window.PORTAL_DATA.news||[]).map(n=>`<li><time>${escapeHtml(n.date||'')}</time> ${n.label?`<span class="label">${escapeHtml(n.label)}</span>`:''} ${n.text||''}</li>`).join('');
    }
    function renderEvents(){
      const g=document.getElementById('eventsGrid'); if(!g) return;
      g.innerHTML=(window.PORTAL_DATA.events||[]).map(e=>`
        <article class="card">
          <img src="${e.image}" alt="${escapeHtml(e.alt||e.title||'')}" class="thumb" data-full="${e.image}" loading="lazy">
          <div class="body">
            <h3>${escapeHtml(e.title||'')}</h3>
            <p>${escapeHtml(e.datetext||'')}</p>
            ${e.chip?`<div class="chip">${escapeHtml(e.chip)}</div>`:''}
          </div>
        </article>
      `).join('');
    }
    function renderSchedule(){
      const tbody=document.getElementById('scheduleBody'); if(!tbody) return;
      const today=new Date(); today.setHours(0,0,0,0); const limit=new Date(today); limit.setDate(today.getDate()+7);
      const rows=(window.PORTAL_DATA.schedule||[]).filter(r=>{ const d=parseSheetDateToJsDate(r.date); if(!d) return true; d.setHours(0,0,0,0); return d>=today && d<=limit; });
      tbody.innerHTML=rows.map(r=>`<tr><td>${escapeHtml((r.date||'').toString())}</td><td>${escapeHtml((r.hours||'').toString())}</td><td>${escapeHtml((r.note||'').toString())}</td></tr>`).join('');
    }

    async function maybeLoad(url,key,statusId,conv){
      const s=document.getElementById(statusId);
      try{ const text=await loadCSV(url); window.PORTAL_DATA[key]=(conv?conv(text):[]); s&&(s.textContent=`${key}：CSVから${window.PORTAL_DATA[key].length}件を読み込みました`); return true; }
      catch(e){ s&&(s.textContent=`${key}：CSV取得に失敗（${e.message}）`); return false; }
    }

    // 初期データホルダ
    window.PORTAL_DATA={news:[],events:[],schedule:[]};

    // 起動
    document.addEventListener('DOMContentLoaded', async ()=>{
      // 年表示
      const yearEl=document.getElementById('year'); if(yearEl) yearEl.textContent=new Date().getFullYear();

      // ドロワー
      const btnMenu=document.getElementById('btnMenu'); const drawer=document.getElementById('drawer'); const btnClose=document.getElementById('btnClose');
      if(btnMenu && drawer && btnClose){ const toggleDrawer=(open)=>{drawer.classList.toggle('open',open); drawer.setAttribute('aria-hidden', String(!open)); btnMenu.setAttribute('aria-expanded', String(open));};
        btnMenu.addEventListener('click',()=>toggleDrawer(true)); btnClose.addEventListener('click',()=>toggleDrawer(false)); drawer.addEventListener('click',(e)=>{ if(e.target.tagName==='A') toggleDrawer(false); }); }

      // 外部リンク
      const linkQuest=document.getElementById('linkQuest'); const linkMBTI=document.getElementById('linkMBTI');
      if(linkQuest) linkQuest.href='quest.html'; if(linkMBTI) linkMBTI.href='mbti-mini.html';

      // CSV読み込み → 描画
      await maybeLoad(PORTAL_CONFIG.newsCsvUrl,     'news',     'newsStatus',     csvToNewsObjects);
      await maybeLoad(PORTAL_CONFIG.eventsCsvUrl,   'events',   'eventsStatus',   csvToEventObjects);
      await maybeLoad(PORTAL_CONFIG.scheduleCsvUrl, 'schedule', 'scheduleStatus', csvToScheduleObjects);
      renderNews(); renderEvents(); renderSchedule();

      // ライトボックス動作
      const lightbox=document.getElementById('lightbox'); const lightImg=document.getElementById('lightboxImg'); const closeBtn=lightbox.querySelector('.close');
      const openLightbox=(src,alt)=>{ lightImg.src=src; lightImg.alt=alt||'拡大画像'; lightbox.classList.add('open'); lightbox.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
      const closeLightbox=()=>{ lightbox.classList.remove('open'); lightbox.setAttribute('aria-hidden','true'); lightImg.removeAttribute('src'); document.body.style.overflow=''; };
      const eventsGrid=document.getElementById('eventsGrid');
      if(eventsGrid){
        eventsGrid.addEventListener('click',(e)=>{ const img=e.target.closest('img'); if(!img) return; openLightbox(img.getAttribute('data-full')||img.src, img.alt); });
      }
      lightbox.addEventListener('click',(e)=>{ if(e.target===lightbox) closeLightbox(); });
      closeBtn.addEventListener('click', closeLightbox);
      window.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && lightbox.classList.contains('open')) closeLightbox(); });

      // ?embed=true 簡略
      const params = new URLSearchParams(location.search);
      if(params.get('embed')==='true'){
        const header=document.querySelector('header'); const footer=document.querySelector('footer');
        if(header) header.style.display='none'; if(footer) footer.style.display='none';
        document.querySelectorAll('section').forEach(s=>s.style.padding='12px 0');
      }
    });
  </script>
</body>
</html>
