<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POãƒ»TORO å…¬å¼ãƒãƒ¼ã‚¿ãƒ«</title>
  <meta name="description" content="concept cafe POãƒ»TOROï¼ˆãƒãƒ»ãƒˆãƒ­ï¼‰ã®ç·åˆãƒãƒ¼ã‚¿ãƒ«ã€‚æœ€æ–°ã‚¤ãƒ™ãƒ³ãƒˆã€ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹ã€ã‚¢ã‚¯ã‚»ã‚¹ã€å„ç¨®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®å…¥å£ã‚’ã²ã¨ã¾ã¨ã‚ã€‚" />
  <meta name="format-detection" content="telephone=no" />
  <!-- OGP -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="POãƒ»TORO å…¬å¼ãƒãƒ¼ã‚¿ãƒ«" />
  <meta property="og:description" content="concept cafe POãƒ»TOROï¼ˆãƒãƒ»ãƒˆãƒ­ï¼‰ã®æœ€æ–°æƒ…å ±ã¨ãƒªãƒ³ã‚¯é›†ã€‚" />
  <meta property="og:image" content="img/ogp.jpg" />
  <meta property="og:url" content="https://example.com" />
  <link rel="icon" href="img/favicon.png" />
  <style>
    :root{--pink:#f6b7d2;--blue:#a9d6f7;--deep:#2a2a2a;--ink:#333;--bg:#fff;--card:#ffffffcc;--shadow:0 10px 30px rgba(0,0,0,.12);--radius:16px}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:"-apple-system","BlinkMacSystemFont","Hiragino Kaku Gothic ProN","Noto Sans JP",Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji",sans-serif;color:var(--ink);background:linear-gradient(135deg,var(--pink),var(--blue));background-attachment: fixed}
    a{color:#0b69d5;text-decoration:none}
    img{max-width:100%;height:auto;display:block}
    .container{width:min(1100px,92vw);margin:0 auto}
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(10px);background:rgba(255,255,255,.75);box-shadow:0 2px 12px rgba(0,0,0,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-logo{width:40px;height:40px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #fff, #ffe2ee 60%, #ffd3ea 100%);display:grid;place-items:center;box-shadow:var(--shadow)}
    .brand-logo span{font-weight:900;color:#ff5ea8}
    .brand-title{font-weight:800;letter-spacing:.08em}
    .brand-title .en{font-size:1.05rem}
    .brand-title .jp{font-size:.8rem;color:#666}
    .nav-links{display:flex;gap:14px;align-items:center}
    .nav-links a{padding:8px 12px;border-radius:999px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.06);font-size:.92rem}
    .hamburger{display:none;background:#fff;border:none;border-radius:12px;padding:9px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    .hamburger svg{width:22px;height:22px}
    @media (max-width:880px){.nav-links{display:none}.hamburger{display:inline-grid}.drawer{position:fixed;inset:0 0 0 auto;width:min(84vw,360px);background:#fff;box-shadow:-20px 0 40px rgba(0,0,0,.18);transform:translateX(100%);transition:.3s;z-index:60;display:flex;flex-direction:column}.drawer.open{transform:translateX(0)}.drawer .head{display:flex;align-items:center;justify-content:space-between;padding:16px}.drawer a{padding:14px 18px;border-bottom:1px solid #eee}}
    .hero{position:relative;isolation:isolate}
    .hero .wrap{display:grid;grid-template-columns:1.2fr .8fr;gap:24px;align-items:center;padding:40px 0}
    .badge{display:inline-flex;gap:8px;align-items:center;background:#fff;border-radius:999px;padding:6px 10px;box-shadow:var(--shadow);font-size:.85rem}
    .headline{font-size:clamp(1.6rem,4vw,2.6rem);line-height:1.16;margin:.4rem 0 .2rem;font-weight:900;letter-spacing:.02em}
    .sub{color:#444;margin:.2rem 0 1rem}
    .cta{display:flex;flex-wrap:wrap;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:14px;border:none;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn-primary{background:linear-gradient(135deg,#ff81c0,#8ed2ff);color:#fff}
    .btn-ghost{background:#fff;color:#333}
    .hero-card{background:var(--card);backdrop-filter: blur(8px);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow)}
    @media (max-width:880px){.hero .wrap{grid-template-columns:1fr}}
    section{padding:34px 0}
    .sec-title{font-weight:900;font-size:1.3rem;margin:0 0 14px 0;display:flex;align-items:center;gap:8px}
    .ticker{background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .ticker ul{list-style:none;margin:0;padding:0}
    .ticker li{display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid #eee}
    .ticker time{font-variant-numeric:tabular-nums;color:#666;min-width:7.7em}
    .label{display:inline-block;padding:.2em .6em;border-radius:999px;font-size:.75rem;font-weight:700;color:#fff;background:#ff72b4}
    .grid{display:grid;gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    @media (max-width:1024px){.grid.cols-4{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:880px){.grid.cols-4,.grid.cols-3{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.grid.cols-4,.grid.cols-3{grid-template-columns:1fr}}
    .card{background:#fff;border-radius:18px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card .thumb{aspect-ratio:16/9;background:#f4f4f4;object-fit:cover}
    /* Heroç”¨ï¼šæŠ•ç¨¿ç”»åƒã‚’ãƒˆãƒªãƒŸãƒ³ã‚°ã›ãšå…¨ä½“è¡¨ç¤º */
    .hero-kv{width:100%;height:auto;object-fit:contain;background:#fff;border-radius:12px}
    .card .body{padding:12px 14px}
    .card h3{margin:.2rem 0 .4rem;font-size:1.05rem}
    .card p{margin:0;color:#555;font-size:.92rem}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#fafafa;border:1px solid #eee;border-radius:999px;padding:4px 8px;font-size:.78rem}
    .qlink{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;text-align:center;background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:18px;min-height:120px}
    .table{width:100%;border-collapse:collapse;background:#fff;border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .table th,.table td{padding:12px;border-bottom:1px solid #eee;text-align:left}
    .table th{background:#fafafa}
    footer{padding:28px 0;color:#333}
    .foot{display:grid;gap:16px;grid-template-columns:2fr 1fr 1fr}
    .foot h4{margin:.2rem 0 .6rem}
    .sns{display:flex;gap:10px}
    .copyright{margin-top:12px;font-size:.85rem;color:#555}
    @media (max-width:880px){.foot{grid-template-columns:1fr}}
    .hidden{display:none}
    .mt-8{margin-top:8px}.mt-12{margin-top:12px}.mt-16{margin-top:16px}.mt-24{margin-top:24px}
    .tag{font-size:.75rem;color:#666}
  </style>
</head>
<body>
  <header>
    <nav class="nav container" aria-label="Main">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"><span>PT</span></div>
        <div class="brand-title">
          <div class="en">concept cafe <span style="letter-spacing:.12em">POãƒ»TORO</span></div>
          <div class="jp">ãƒãƒ»ãƒˆãƒ­ å…¬å¼ãƒãƒ¼ã‚¿ãƒ«</div>
        </div>
      </div>
      <div class="nav-links" id="navLinks">
        <a href="#news">ãŠçŸ¥ã‚‰ã›</a>
        <a href="#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a>
        <a href="#maids">ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹</a>
        <a href="#games">ã‚²ãƒ¼ãƒ /è¨ºæ–­</a>
        <a href="#schedule">å–¶æ¥­æ—¥</a>
        <a href="#access">ã‚¢ã‚¯ã‚»ã‚¹</a>
      </div>
      <button class="hamburger" id="btnMenu" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã" aria-controls="drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
      </button>
    </nav>
    <div class="drawer" id="drawer" aria-hidden="true">
      <div class="head">
        <div style="font-weight:800">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
        <button id="btnClose" aria-label="é–‰ã˜ã‚‹">âœ•</button>
      </div>
      <a href="#news">ãŠçŸ¥ã‚‰ã›</a>
      <a href="#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a>
      <a href="#maids">ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹</a>
      <a href="#games">ã‚²ãƒ¼ãƒ /è¨ºæ–­</a>
      <a href="#schedule">å–¶æ¥­æ—¥</a>
      <a href="#access">ã‚¢ã‚¯ã‚»ã‚¹</a>
      <a href="#sns">SNS</a>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <div class="container wrap">
        <div>
          <span class="badge" aria-label="æœ€æ–°ã®æ›´æ–°">ğŸ”” æœ€æ–°æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯</span>
          <h1 class="headline">ã‚ˆã†ã“ãã€ã”ä¸»äººã•ã¾ãƒ»ãŠå¬¢ã•ã¾ã€‚<br>POãƒ»TOROã®å…¥å£ã¯ã“ã“â™¡</h1>
          <p class="sub">ã‚¤ãƒ™ãƒ³ãƒˆã€ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹ã€ã‚²ãƒ¼ãƒ ã‚„å„ç¨®ãƒªãƒ³ã‚¯ã‚’ã“ã®ãƒšãƒ¼ã‚¸ã«é›†ç´„ã—ã¾ã—ãŸã€‚ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ¨å¥¨ã§ã™ï¼</p>
          <div class="cta">
            <a class="btn btn-primary" href="#events">ã‚¤ãƒ™ãƒ³ãƒˆæ¡ˆå†…ã¸</a>
            <a class="btn btn-ghost" href="#games">è¨ºæ–­ãƒ»ã‚²ãƒ¼ãƒ ã§éŠã¶</a>
          </div>
          <div class="hero-card mt-16">
            <strong>ãŠçŸ¥ã‚‰ã›ï¼š</strong>
            <span class="tag">ï¼ˆä¾‹ï¼‰10/28â€“10/31 ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…ãŠçµ¦ä»•é–‹å‚¬ãƒ»å…ˆç€ã§ãŠè“å­ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼</span>
          </div>
        </div>
        <div class="hero-card">
          <img src="img/potro_twi.jpg" alt="POãƒ»TORO ã‚­ãƒ¼ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«" class="thumb hero-kv" />
          <div class="mt-12" style="font-size:.9rem;color:#555">
        </div>
      </div>
    </section>

    <!-- News -->
    <section id="news">
      <div class="container">
        <h2 class="sec-title">ğŸ—ï¸ ãŠçŸ¥ã‚‰ã›</h2>
        <div class="ticker" aria-live="polite">
          <ul id="newsList"></ul>
        </div>
      </div>
    </section>

    <!-- Events -->
    <section id="events">
      <div class="container">
        <h2 class="sec-title">ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
        <div class="grid cols-3" id="eventsGrid"></div>
        <div id="eventsStatus" class="tag mt-12" aria-live="polite"></div>
      </div>
    </section>

    <!-- ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹ -->
    <section id="maids">
      <div class="container">
        <h2 class="sec-title">ğŸ‘‘ ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹</h2>
        <div class="mt-12">
          <a class="btn btn-ghost" href="public.html" target="_blank" rel="noopener">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ï¼ˆé–²è¦§ç”¨ï¼‰</a>
        </div>
      </div>
    </section>

    <!-- Games / Tools -->
    <section id="games">
      <div class="container">
        <h2 class="sec-title">ğŸ® ã‚²ãƒ¼ãƒ  / è¨ºæ–­</h2>
        <div class="grid cols-4">
          <a class="qlink" href="#" id="linkQuest">
            <div>ğŸ—ï¸</div>
            <div><strong>ãƒãƒ»ãƒˆãƒ­ã‚¯ã‚¨ã‚¹ãƒˆ</strong></div>
            <small class="tag">å®Œæˆç‰ˆï¼ˆåŸºæº–ãƒ“ãƒ«ãƒ‰ï¼‰</small>
          </a>
          <a class="qlink" href="#" id="linkMBTI">
            <div>ğŸ’˜</div>
            <div><strong>ã”ä¸»äººæ§˜ã‚¿ã‚¤ãƒ—è¨ºæ–­</strong></div>
            <small class="tag">MBTIãƒŸãƒ‹12å•ãƒ»ãƒ¬ãƒ¼ã‚¹ver.</small>
          </a>
        </div>
      </div>
    </section>

    <!-- Schedule -->
    <section id="schedule">
      <div class="container">
        <h2 class="sec-title">ğŸ“… å–¶æ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
        <table class="table" aria-label="å–¶æ¥­æ—¥ã¨å–¶æ¥­æ™‚é–“">
          <thead><tr><th>æ—¥ä»˜</th><th>å–¶æ¥­æ™‚é–“</th><th>ãƒ¡ãƒ¢</th></tr></thead>
          <tbody id="scheduleBody">
            <tr><td>2025-10-28(ç«)</td><td>18:00â€“24:00</td><td>ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…Day 1</td></tr>
            <tr><td>2025-10-29(æ°´)</td><td>18:00â€“24:00</td><td>ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…Day 2</td></tr>
            <tr><td>2025-10-30(æœ¨)</td><td>18:00â€“24:00</td><td>ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…Day 3</td></tr>
            <tr><td>2025-10-31(é‡‘)</td><td>18:00â€“24:00</td><td>ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…Day 4 / å…ˆç€ãŠè“å­</td></tr>
          </tbody>
        </table>
        <p class="tag mt-12">â€» ä¾‹ç¤ºã§ã™ã€‚Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŸ‹ã‚è¾¼ã¿ã‚„ã€CSVèª­è¾¼ã§ã®è‡ªå‹•æ›´æ–°ã«ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚</p>
      </div>
    </section>

    <!-- Access -->
    <section id="access">
      <div class="container">
        <h2 class="sec-title">ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹</h2>
        <div class="grid cols-3">
          <div class="card" style="grid-column: span 2;">
            <div class="body">
              <h3>åº—èˆ—æƒ…å ±</h3>
              <p>ã€’790-0012 æ„›åª›çœŒæ¾å±±å¸‚æ¹Šç”º3-7-2 2F</p>
              <p>å–¶æ¥­æ™‚é–“ï¼šå¹³æ—¥ï¼†ç¥ 18:00â€“22:00 / åœŸæ—¥ 17:00â€“22:00</p>
              <p>æ–™é‡‘ï¼š30åˆ† 1,000å††(ç¨è¾¼) å„ç¨®ãƒ‰ãƒªãƒ³ã‚¯é£²ã¿æ”¾é¡Œï¼ˆç”Ÿãƒ“ãƒ¼ãƒ«å«ã‚€ï¼‰</p>
              <p class="tag">â€»æ”¾ç½®ã‚¼ãƒ­å®£è¨€ï¼†ã‚­ãƒ£ã‚¹ãƒˆãƒ‰ãƒªãƒ³ã‚¯ç„¡ã—ã§å®‰å¿ƒâ™ª</p>
            </div>
          </div>
          <div class="card">
            <img src="https://picsum.photos/seed/potoro-map/800/450" alt="åœ°å›³ã®ãƒ€ãƒŸãƒ¼ç”»åƒ" class="thumb" />
            <div class="body">
              <h3>åœ°å›³</h3>
              <p>Google ãƒãƒƒãƒ—åŸ‹ã‚è¾¼ã¿æ ï¼ˆä½æ‰€ç¢ºå®šå¾Œã« iframe ã‚’é…ç½®ï¼‰</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SNS -->
    <section id="sns">
      <div class="container">
        <h2 class="sec-title">ğŸ“¡ å…¬å¼SNS</h2>
        <div class="sns">
          <a class="qlink" href="https://x.com/po_toro" target="_blank" aria-label="X / Twitter">ğŸ•Šï¸ Xï¼ˆ@po_toroï¼‰</a>
          <a class="qlink" href="https://www.tiktok.com/@potoro_o" target="_blank" aria-label="TikTok">ğŸµ TikTokï¼ˆ@potoro_oï¼‰</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <div>
        <h4>concept cafe POãƒ»TORO</h4>
        <p>ã”å¸°å®…ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã‚„é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æœ€æ–°æƒ…å ±ã¯æœ¬ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚</p>
        <div class="copyright">Â© <span id="year"></span> POãƒ»TORO / concept cafe. All rights reserved.</div>
      </div>
      <div>
        <h4>ãƒªãƒ³ã‚¯</h4>
        <ul>
          <li><a href="#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a></li>
          <li><a href="#maids">ãƒ¡ã‚¤ãƒ‰ã•ã‚“ç´¹ä»‹</a></li>
          <li><a href="#games">ã‚²ãƒ¼ãƒ /è¨ºæ–­</a></li>
        </ul>
      </div>
      <div>
        <h4>ãƒãƒªã‚·ãƒ¼</h4>
        <ul>
          <li><a href="#">åˆ©ç”¨è¦ç´„</a></li>
          <li><a href="#">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a></li>
          <li><a href="#">ç‰¹å®šå•†å–å¼•æ³•</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <script>
    // =========================
    // è¨­å®šï¼šGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå…¬é–‹CSV
    // =========================
    window.PORTAL_CONFIG = {
      // å…¬é–‹CSVã®URLï¼ˆGoogleã‚·ãƒ¼ãƒˆ â†’ ãƒ•ã‚¡ã‚¤ãƒ« â†’ ã‚¦ã‚§ãƒ–ã«å…¬é–‹ â†’ CSVï¼‰
      eventsCsvUrl: "https://docs.google.com/spreadsheets/d/1rqajpwmrRffVgtfBS7fgvgyrCS7YgfkW5RyedstpDnw/export?format=csv&gid=365949763"
    };

    // =========================
    // JSONãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯/ä»–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”¨ï¼‰
    // =========================
    window.PORTAL_DATA = {
      hero: { image: "img/potro_twi.jpg", caption: "â€» æ·»ä»˜ã„ãŸã ã„ãŸç”»åƒã‚’ä½¿ç”¨ä¸­" },
      news: [
        { date: "2025-10-19", label: "NEW", text: "ãƒãƒ¼ã‚¿ãƒ«Î²ç‰ˆå…¬é–‹ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ­“è¿ï¼" },
        { date: "2025-10-18", label: "",   text: "ãƒ¡ã‚¤ãƒ‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¬é–‹ä¿®æ­£ï¼ˆç”»åƒãƒ‘ã‚¹çµ±ä¸€ï¼‰ã€‚" },
        { date: "2025-10-15", label: "",   text: "<strong>èŒãˆã‚»ãƒ¬ã‚¯ãƒˆLite</strong> æä¾›é–‹å§‹ï¼ˆå½“æ—¥é™å®šãƒ»æ»åœ¨ä¸­ã®ã¿ï¼‰ã€‚" }
      ],
      events: [ // CSVæœªè¨­å®š/å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        { title: "ãƒãƒ­ã‚¦ã‚£ãƒ³ä»®è£…ãŠçµ¦ä»•", dateText: "10/28(ç«)ã€œ10/31(é‡‘)ã€‚å…ˆç€ã§ãŠè“å­ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼ˆåœ¨åº«é™ã‚Šï¼‰ã€‚", image: "https://picsum.photos/seed/potoro-event1/800/450", alt: "ã‚¤ãƒ™ãƒ³ãƒˆç”»åƒï¼ˆãƒ€ãƒŸãƒ¼1ï¼‰", chip: "#ãƒãƒ»ãƒˆãƒ­ #Halloween" },
        { title: "6å‘¨å¹´è¨˜å¿µã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³", dateText: "10/6(æœˆ)ã€œ10/31(é‡‘)ã€‚ã‚²ãƒ¼ãƒ é€£å‹•ã®ç‰¹åˆ¥æ™¯å“ã‚‚ï¼", image: "https://picsum.photos/seed/potoro-event2/800/450", alt: "ã‚¤ãƒ™ãƒ³ãƒˆç”»åƒï¼ˆãƒ€ãƒŸãƒ¼2ï¼‰", chip: "#Anniversary" },
        { title: "æ¬¡å›äºˆå‘Š", dateText: "è¿‘æ—¥å…¬é–‹ã€‚æŠ•ç¥¨ãƒ»é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã»ã‹ã€ç¶šå ±ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚", image: "https://picsum.photos/seed/potoro-event3/800/450", alt: "ã‚¤ãƒ™ãƒ³ãƒˆç”»åƒï¼ˆãƒ€ãƒŸãƒ¼3ï¼‰", chip: "#ComingSoon" }
      ],
      sns: [
        { name: "X", icon: "ğŸ•Šï¸", href: "https://x.com/po_toro", arialabel: "X / Twitter" },
        { name: "TikTok", icon: "ğŸµ", href: "https://www.tiktok.com/@potoro_o", arialabel: "TikTok" }
      ]
    };

    // =========================
    // CSVãƒ‘ãƒ¼ã‚µï¼ˆè»½é‡/ã‚¯ã‚©ãƒ¼ãƒˆå¯¾å¿œï¼‰
    // =========================
    function parseCSV(text){
      const rows = [];
      let i=0, field='', row=[], inQuotes=false;
      while(i < text.length){
        const c = text[i];
        if(inQuotes){
          if(c==='"'){
            if(text[i+1]==='"'){ field+='"'; i+=2; continue; } // "" â†’ "
            inQuotes=false; i++; continue;
          }
          field += c; i++; continue;
        } else {
          if(c==='"'){ inQuotes=true; i++; continue; }
          if(c===','){ row.push(field); field=''; i++; continue; }
          if(c==='\n' || c==='\r'){
            if(c==='\r' && text[i+1]==='\n') i++; // CRLF
            row.push(field); field='';
            if(row.length>1 || row[0]!=='' ){ rows.push(row); }
            row=[]; i++; continue;
          }
          field += c; i++; continue;
        }
      }
      if(field!=='' || row.length){ row.push(field); rows.push(row); }
      return rows;
    }

    function csvToObjects(csvText){
      // å…ˆé ­BOMé™¤å»
      if(csvText.charCodeAt(0) === 0xFEFF){ csvText = csvText.slice(1); }
      const rows = parseCSV(csvText).filter(r=>r.length && r.join('').trim()!=='' );
      if(rows.length===0) return [];
      // ãƒ˜ãƒƒãƒ€æ¨™æº–åŒ–
      const norm = (s)=> String(s||'').replace(/^\uFEFF/u, '').trim().toLowerCase();
      const header = rows[0].map(norm);
      // å¤šè¨€èª/åˆ¥åãƒ˜ãƒƒãƒ€å¯¾å¿œ
      const alias = {
        title:    ['title','ã‚¿ã‚¤ãƒˆãƒ«','ä»¶å','ã‚¤ãƒ™ãƒ³ãƒˆå'],
        datetext: ['datetext','date','æ—¥ä»˜','æœŸé–“','date_text'],
        image:    ['image','ç”»åƒ','img','imageurl','image_url'],
        alt:      ['alt','ä»£æ›¿','ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆ','alttext'],
        chip:     ['chip','ã‚¿ã‚°','tag','ãƒ©ãƒ™ãƒ«']
      };
      const findIdx = (keys)=>{ for(const k of keys){ const i = header.indexOf(k); if(i!==-1) return i; } return -1; };
      const ti = findIdx(alias.title);
      const di = findIdx(alias.datetext);
      const ii = findIdx(alias.image);
      const ai = findIdx(alias.alt);
      const ci = findIdx(alias.chip);
      return rows.slice(1).map(r=>({
        title: ti>-1? r[ti] : '',
        dateText: di>-1? r[di] : '',
        image: ii>-1? r[ii] : '',
        alt: ai>-1? r[ai] : '',
        chip: ci>-1? r[ci] : ''
      })).filter(o => (o.title && o.title.trim()) || (o.image && o.image.trim()));
    }

    async function maybeLoadEventsFromCSV(){
      const url = (window.PORTAL_CONFIG||{}).eventsCsvUrl;
      const statusEl = document.getElementById('eventsStatus');
      if(!url){ if(statusEl) statusEl.textContent = 'ã‚¤ãƒ™ãƒ³ãƒˆï¼šãƒšãƒ¼ã‚¸å†…ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­ï¼ˆCSVæœªè¨­å®šï¼‰'; return false; }
      try{
        const res = await fetch(url, { cache: 'no-store', credentials: 'omit' });
        if(!res.ok){ throw new Error(`CSV fetch failed: ${res.status} ${res.statusText}`); }
        const text = await res.text();
        const objs = csvToObjects(text);
        if(objs && objs.length){
          window.PORTAL_DATA.events = objs;
          if(statusEl) statusEl.textContent = `ã‚¤ãƒ™ãƒ³ãƒˆï¼šCSVã‹ã‚‰${objs.length}ä»¶ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
          return true;
        } else {
          if(statusEl) statusEl.textContent = 'ã‚¤ãƒ™ãƒ³ãƒˆï¼šCSVã«ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆãƒ˜ãƒƒãƒ€/å†…å®¹ã‚’ã”ç¢ºèªãã ã•ã„ï¼‰';
        }
      }catch(e){
        console.warn('CSVèª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚', e);
        if(statusEl) statusEl.textContent = 'ã‚¤ãƒ™ãƒ³ãƒˆï¼šCSVã®å–å¾—ã«å¤±æ•—ï¼ˆå…¬é–‹/æ¨©é™/CORSã‚’ã”ç¢ºèªãã ã•ã„ï¼‰';
      }
      return false;
    }

    // =========================
    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
    // =========================
    function escapeHtml(str){ return String(str).replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s])); }

    function renderNews(){
      const list = document.getElementById('newsList');
      if(!list) return;
      list.innerHTML = (window.PORTAL_DATA.news||[]).map(n => {
        const label = n.label ? `<span class="label">${escapeHtml(n.label)}</span>` : '';
        return `<li><time>${escapeHtml(n.date)}</time>${label} ${n.text}</li>`;
      }).join('');
    }

    function renderEvents(){
      const grid = document.getElementById('eventsGrid');
      if(!grid) return;
      grid.innerHTML = (window.PORTAL_DATA.events||[]).map(ev => `
        <article class="card">
          <img src="${ev.image}" alt="${escapeHtml(ev.alt||ev.title)}" class="thumb" />
          <div class="body">
            <h3>${escapeHtml(ev.title)}</h3>
            <p>${escapeHtml(ev.dateText||'')}</p>
            ${ev.chip ? `<div class="mt-12 chip">${escapeHtml(ev.chip)}</div>` : ''}
          </div>
        </article>
      `).join('');
    }

    function renderSNS(){
      const wrap = document.querySelector('#sns .sns');
      if(!wrap) return;
      wrap.innerHTML = (window.PORTAL_DATA.sns||[]).map(s => `
        <a class="qlink" href="${s.href}" target="_blank" aria-label="${escapeHtml(s.arialabel||s.name)}">${s.icon} ${escapeHtml(s.name)}</a>
      `).join('');
    }

    // =========================
    // é–‹ç™ºè€…ç”¨: æœ€å°ãƒ†ã‚¹ãƒˆï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
    // =========================
    (function runDevTests(){
      try{
        // 1) æ”¹è¡Œ/ã‚«ãƒ³ãƒ/å¼•ç”¨ç¬¦ã‚’å«ã‚€CSV
        const csv = [
          'title,dateText,image,alt,chip',
          'A,"10/28(ç«)ã€œ10/31(é‡‘), å…ˆç€ã‚ã‚Š",img/a.jpg,ä»£æ›¿A,#A',
          'B,,img/b.jpg,,',
          'C,"ãƒ†ã‚­ã‚¹ãƒˆã«""äºŒé‡å¼•ç”¨ç¬¦""",img/c.jpg,ä»£æ›¿C,#C'
        ].join('\n');
        const rows = parseCSV(csv);
        console.assert(rows.length === 4, 'rows length');
        const objs = csvToObjects(csv);
        console.assert(objs.length === 3, 'objs length');
        console.assert(objs[0].title === 'A', 'obj[0] title');
        console.assert(objs[2].dateText.includes('äºŒé‡å¼•ç”¨ç¬¦'), 'quotes handling');

        // 2) ãƒ˜ãƒƒãƒ€å¤§æ–‡å­—æ··åœ¨ + æ—¥æœ¬èªãƒ˜ãƒƒãƒ€
        const csv2 = [
          'Title,æœŸé–“,Image,Alt,Tag',
          'X,æœŸé–“ãƒ†ã‚­ã‚¹ãƒˆ,https://example.com/x.png,ä»£æ›¿X,#X'
        ].join('\n');
        const o2 = csvToObjects(csv2);
        console.assert(o2[0].image.includes('example.com'), 'header alias/lowercasing');

        // 3) BOMå…ˆé ­ + ç©ºè¡Œ
        const csv3 = '\uFEFFtitle,dateText\nOnlyTitle,\n\n';
        const o3 = csvToObjects(csv3);
        console.assert(o3.length === 1 && o3[0].title === 'OnlyTitle', 'BOM & empty lines');

        // 4) å…ˆé ­è¡Œã ã‘/ãƒ‡ãƒ¼ã‚¿ç„¡ã—
        const csv4 = 'title,dateText,image,alt,chip\n';
        const o4 = csvToObjects(csv4);
        console.assert(Array.isArray(o4) && o4.length === 0, 'no data rows');

        console.log('[DEV TESTS] OK');
      }catch(err){
        console.error('[DEV TESTS] FAILED', err);
      }
    })();

    document.addEventListener('DOMContentLoaded', async () => {
      // å¹´è¡¨ç¤º
      const yearEl = document.getElementById('year');
      if(yearEl) yearEl.textContent = new Date().getFullYear();

      // ãƒ‰ãƒ­ãƒ¯ãƒ¼
      const btnMenu = document.getElementById('btnMenu');
      const drawer = document.getElementById('drawer');
      const btnClose = document.getElementById('btnClose');
      if(btnMenu && drawer && btnClose){
        const toggleDrawer = (open)=>{
          drawer.classList.toggle('open', open);
          drawer.setAttribute('aria-hidden', String(!open));
          btnMenu.setAttribute('aria-expanded', String(open));
        };
        btnMenu.addEventListener('click',()=>toggleDrawer(true));
        btnClose.addEventListener('click',()=>toggleDrawer(false));
        drawer.addEventListener('click', (e)=>{ if(e.target.tagName==='A') toggleDrawer(false); });
      }

      // å¤–éƒ¨ãƒªãƒ³ã‚¯
      const linkQuest = document.getElementById('linkQuest');
      const linkMBTI = document.getElementById('linkMBTI');
      if(linkQuest) linkQuest.href = "quest.html";
      if(linkMBTI) linkMBTI.href = "mbti-mini.html";

      // ã¾ãšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§æç”»ï¼ˆä½“æ„Ÿé«˜é€ŸåŒ–ï¼‰
      renderNews();
      renderSNS();
      renderEvents();

      // CSVãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°ä¸Šæ›¸ãæç”»
      if(await maybeLoadEventsFromCSV()){
        renderEvents();
      }

      // ?embed=true ã®ã¨ããƒ˜ãƒƒãƒ€ãƒ¼ç°¡ç•¥åŒ–
      const params = new URLSearchParams(location.search);
      if(params.get('embed')==='true'){
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        if(header) header.style.display='none';
        if(footer) footer.style.display='none';
        document.querySelectorAll('section').forEach(s=>s.style.padding='12px 0');
      }
    });
  </script>
</body>
</html>
